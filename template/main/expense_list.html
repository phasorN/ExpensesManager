{% extends 'main/base.html' %}

{% block title_block %}
	<title>Expense List</title>
{% endblock %}


{% block body_block %}
	{% if confirmed == False %}
		<p style="color: red;">Your email is not confirmed.You can only add expenses but can not view them.</p>
	{% else %}
		<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
		<style type="text/css">
			table, th, td{
				border:solid black 1px;
				padding-left: 5px;
				padding-right: 5px;
			}
			td{
				width: 100%
			}
			th{
				width: 70%
			}
		</style>
		<script type="text/javascript">
			$(document).ready(function(){

				{% regroup expense_list by date as regrouped_expense_list %}

					{% for date, expense_data in regrouped_expense_list %}
						
						$("#{{ date|date:"U" }}").click(function(){
							$("#{{ date|date:"U" }}_div").slideToggle("slow")
						});
						var t = 0;
							{% for e in expense_data %}
								{% if forloop.counter0 == 0 %}
								{% endif %}
								t += {{ e.amount }};
							{% endfor %}
									a = "<tr><th style = 'text-align:right'>Total: </th><td><strong>Rs " + t + "</strong></td></tr>"
									$("#{{ date|date:"U" }}_table").append(a)
									
						{% if not query %}
							{% if forloop.counter0 == 0 %}
							$("#{{ date|date:"U" }}_div").slideToggle("slow")
							{% endif %}
						{% endif %}
									
						
					{% endfor %}
				})
		</script>
		<div class="jumbotron" >
			<form action="{% url 'main:expense_list' %}" method="GET">
				<div class="input-group input-group-sm mb-3">
					<input type="text" class="form-control" aria-label="Small" aria-describedby="inputGroup-sizing-sm" name="query">
					<!-- <div class="input-group-append"> -->
						<input type = "submit" class=" btn input-group-text" style="background-color: rgba(21, 21, 21, 0.3)" id="inputGroup-sizing-sm" value = "Search">
					<!-- </div> -->
				</div>
			</form>
				{% for date, expense_data in regrouped_expense_list %}
				<div class="dropdown">
					<!-- <p> -->
					<button id="{{ date|date:"U" }}" class="btn btn-block dropdown-toggle" style=" background-color: rgb(210, 210, 210);  color: black;">{{ date }}</button>
						{% if not query %}
							<div id="{{ date|date:"U" }}_div" style="display: none; width: 100%">
						{% else %}
							<div id="{{ date|date:"U" }}_div" style =" width: 100%">
						{% endif %}
					
							<table id="{{ date|date:"U" }}_table" style="width: 100%">
							{% for e in expense_data %}
								<tr>
									<th >{{ e.title }}</th>
									<td>Rs {{ e.amount }}</td>
								</tr>
							{% endfor %}
							</table>
						</div>
					<!-- </p> -->
				</div>
				<br>
				{% empty %}
					{% if not query %}
						<!-- If no search is done -->
						<center>
							<p>No expenses yet!</p>
							<p>Click <a href="{% url 'main:add_expense' %}">here</a> to add a new expense.</p>
						</center>
					{% else %}
						<!-- If a search is done -->
						<p style = "color: red">No matching results for your query: <strong>{{ query }}</strong></p>
					{% endif %}

				{% endfor %}
		</div>
	{% endif %}
{% endblock %}